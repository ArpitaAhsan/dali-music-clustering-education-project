import pandas as pd
import numpy as np
import os
from src.dataset import load_dataset, get_mfcc_features
from src.clustering import run_kmeans, evaluate_clusters

os.makedirs('results', exist_ok=True)

print("Generating clustering_metrics.csv...")
df = load_dataset()
X, _ = get_mfcc_features(df)

# Test K=3 to 12 â†’ Save metrics
scores = []
for k in range(3, 13):
    _, labels = run_kmeans(X, k)
    score = evaluate_clusters(X, labels)
    score['k'] = k
    scores.append(score)
    print(f"K={k}: Silhouette={score['silhouette']:.3f}")

df_scores = pd.DataFrame(scores).set_index('k')
df_scores.to_csv('results/clustering_metrics.csv')
print("results/clustering_metrics.csv")
print(df_scores)
 
